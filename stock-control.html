<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Best Stock</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="theme.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-brand">
                <img src="img/best_stock_logo.png" alt="Best Stock Logo" class="header-logo">
                <h1 class="header-title">Best Stock</h1>
            </div>
            <div class="theme-toggle">
                <span id="theme-text">Tema claro</span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="user-profile">

            </div>
        </header>

        <!-- Navigation Drawer -->
        <nav class="nav-drawer">
            <a href="#" class="nav-item active" data-page="lookup">
                <span class="material-icons">search</span>
                Consulta de Produtos
            </a>
            <a href="#" class="nav-item" data-page="create">
                <span class="material-icons">add_circle</span>
                Criar Produto
            </a>
            <a href="#" class="nav-item" data-page="update">
                <span class="material-icons">edit</span>
                Atualizar Produto
            </a>
            <a href="#" class="nav-item" data-page="summary">
                <span class="material-icons">analytics</span>
                Resumo
            </a>
            <a href="#" class="nav-item" data-page="about">
                <span class="material-icons">help</span>
                Sobre
            </a>
        </nav>

        <!-- Content Area -->
        <main class="content">
            <!-- Consulta de Produtos -->
            <div class="page active" id="lookup-page">
                <h2>Consulta de Produtos</h2>
                <div class="card">
                    <table class="products-table">
                        <thead>
                            <tr>
                                <th>Imagem</th>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Descrição</th>
                                <th>Quantidade</th>
                                <th>Preço</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="products-list">
                            <!-- Preenchido via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Criar Produto -->
            <div class="page" id="create-page" style="display: none;">
                <h2>Criar Novo Produto</h2>
                <div class="card">
                    <form id="create-product-form">
                        <div class="form-field">
                            <label for="create-name">Nome do Produto</label>
                            <input type="text" id="create-name" required>
                        </div>
                        <div class="form-field">
                            <label for="create-description">Descrição</label>
                            <textarea id="create-description" rows="3" required></textarea>
                        </div>
                        <div class="form-field">
                            <label for="create-quantity">Quantidade</label>
                            <input type="number" id="create-quantity" min="0" required>
                        </div>
                        <div class="form-field">
                            <label for="create-price">Preço</label>
                            <input type="number" id="create-price" min="0" step="0.01" required>
                        </div>
                        <div class="form-field">
                            <label for="create-image">URL da Imagem</label>
                            <input type="url" id="create-image" required>
                        </div>
                        <button type="submit" class="button">Criar Produto</button>
                    </form>
                </div>
            </div>

            <!-- Atualizar Produto -->
            <div class="page" id="update-page" style="display: none;">
                <h2>Atualizar Produto</h2>
                <div class="card">
                    <form id="update-product-form">
                        <div class="form-field">
                            <label for="update-id">ID do Produto</label>
                            <input type="number" id="update-id" required>
                        </div>
                        <div class="form-field">
                            <label for="update-name">Nome do Produto</label>
                            <input type="text" id="update-name" required>
                        </div>
                        <div class="form-field">
                            <label for="update-description">Descrição</label>
                            <textarea id="update-description" rows="3" required></textarea>
                        </div>
                        <div class="form-field">
                            <label for="update-quantity">Quantidade</label>
                            <input type="number" id="update-quantity" min="0" required>
                        </div>
                        <div class="form-field">
                            <label for="update-price">Preço</label>
                            <input type="number" id="update-price" min="0" step="0.01" required>
                        </div>
                        <div class="form-field">
                            <label for="update-image">URL da Imagem</label>
                            <input type="url" id="update-image" required>
                        </div>
                        <button type="submit" class="button">Atualizar Produto</button>
                    </form>
                </div>
            </div>

            <!-- Resumo -->
            <div class="page" id="summary-page" style="display: none;">
                <h2>Resumo do Estoque</h2>
                <div class="card summary-container">
                    <div class="summary-card">
                        <div class="summary-icon">
                            <span class="material-icons">inventory</span>
                        </div>
                        <div class="summary-info">
                            <h3>Total de Produtos</h3>
                            <p id="total-quantity">Carregando...</p>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">
                            <span class="material-icons">paid</span>
                        </div>
                        <div class="summary-info">
                            <h3>Valor Total em Estoque</h3>
                            <p id="total-value">Carregando...</p>
                        </div>
                    </div>
                    <div class="products-summary">
                        <h3>Detalhamento por Produto</h3>
                        <div class="table-container">
                            <table class="products-table">
                                <thead>
                                    <tr>
                                        <th>Produto</th>
                                        <th>Quantidade</th>
                                        <th>Valor Unitário</th>
                                        <th>Valor Total</th>
                                    </tr>
                                </thead>
                                <tbody id="summary-list">
                                    <!-- Preenchido via JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sobre -->
            <div class="page" id="about-page" style="display: none;">
                <h2>Sobre o Projeto</h2>
                <div class="card about-content">
                    <h3>Projeto de Conclusão do Curso de Front-end</h3>
                    
                    <p>Este sistema de controle de estoque representa a culminação do Curso Básico de Front-end oferecido pela ONG Origem Amorim. O projeto demonstra a aplicação prática dos conhecimentos adquiridos em HTML, CSS e JavaScript, as três tecnologias fundamentais para o desenvolvimento web moderno.</p>

                    <p>O curso, ministrado com dedicação e compromisso, é uma iniciativa que visa democratizar o acesso ao conhecimento tecnológico, oferecendo oportunidades de aprendizado para jovens interessados em ingressar no mundo da programação.</p>

                    <h4>Tecnologias Aplicadas</h4>
                    <ul>
                        <li><strong>HTML:</strong> Estruturação semântica e organização do conteúdo</li>
                        <li><strong>CSS:</strong> Estilização moderna com Material Design</li>
                        <li><strong>JavaScript:</strong> Programação dinâmica e integração com APIs</li>
                    </ul>

                    <h4>Importância do Projeto</h4>
                    <p>Este projeto é fruto do empenho e dedicação dos alunos que perseveraram até o final do curso, demonstrando que com determinação e suporte adequado, é possível transformar conhecimento em resultados práticos.</p>

                    <h4>Impacto na Vida dos Jovens</h4>
                    <p>O aprendizado de tecnologia tem um papel transformador na vida dos jovens. Além de abrir portas para oportunidades profissionais em um mercado em constante crescimento, desenvolve habilidades essenciais como:</p>
                    <ul>
                        <li>Pensamento lógico e resolução de problemas</li>
                        <li>Criatividade e inovação</li>
                        <li>Trabalho em equipe e colaboração</li>
                        <li>Autonomia e aprendizado contínuo</li>
                    </ul>

                    <p>A ONG Origem Amorim acredita que a educação tecnológica é uma ferramenta poderosa de transformação social, capaz de criar novas perspectivas e oportunidades para jovens talentos.</p>

                    <div class="about-footer">
                        <p class="signature">Desenvolvido com 💻 e ❤️ por Bryan Gomes da Glória, Julio Araujo dos Santos, Pedro Eduardo Gomes da Silva e Victhor Hugo Santos dos Vasconcelos - Turma 10 - 2025</p>
                        <div class="origem-logo">
                            <img src="img/ORIGEM-LOGO-2019-1.png" alt="Logo Origem Amorim">
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        import ApiService from './api.js';

        // Gerenciamento de páginas
        const pages = document.querySelectorAll('.page');
        const navItems = document.querySelectorAll('.nav-item');

        function showPage(pageId) {
            pages.forEach(page => {
                page.style.display = page.id === pageId ? 'block' : 'none';
            });

            navItems.forEach(item => {
                item.classList.toggle('active', item.dataset.page === pageId.replace('-page', ''));
            });
        }

        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                showPage(`${item.dataset.page}-page`);
            });
        });

        // Carregar lista de produtos
        async function loadProducts() {
            try {
                const products = await ApiService.getAllProducts();
                const tbody = document.getElementById('products-list');
                
                if (!products || products.length === 0) {
                    // Se não houver produtos, exibe mensagem e botão de atalho
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="empty-state">
                                <div class="empty-state-content">
                                    <span class="material-icons empty-state-icon">inventory</span>
                                    <p>Nenhum produto cadastrado</p>
                                    <button class="button" onclick="navigateToCreate()">
                                        <span class="material-icons">add_circle</span>
                                        Criar Novo Produto
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                // Se houver produtos, exibe a tabela normal
                tbody.innerHTML = products.map(product => `
                    <tr>
                        <td>
                            <img src="${product.image || 'img/best_stock_logo.png'}" alt="${product.name}" 
                                onerror="this.src='img/best_stock_logo.png'"
                                class="product-thumbnail">
                        </td>
                        <td>${product.id}</td>
                        <td>${product.name}</td>
                        <td>${product.description}</td>
                        <td>${product.qnt_products}</td>
                        <td>${formatCurrency(product.price)}</td>
                        <td>
                            <button class="button secondary" onclick="editProduct(${product.id})">
                                <span class="material-icons">edit</span>
                            </button>
                            <button class="button delete" onclick="deleteProduct(${product.id})">
                                <span class="material-icons">delete</span>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Erro ao carregar produtos:', error);
                const tbody = document.getElementById('products-list');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <div class="empty-state-content error">
                                <span class="material-icons empty-state-icon">error_outline</span>
                                <p>Erro ao carregar produtos</p>
                                <button class="button" onclick="loadProducts()">
                                    <span class="material-icons">refresh</span>
                                    Tentar Novamente
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }
        }

        // Função para navegar para a página de criação
        window.navigateToCreate = function() {
            showPage('create-page');
        };

        // Criar produto
        document.getElementById('create-product-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const productData = {
                    name: document.getElementById('create-name').value,
                    description: document.getElementById('create-description').value,
                    qnt_products: parseInt(document.getElementById('create-quantity').value),
                    price: parseFloat(document.getElementById('create-price').value),
                    image: document.getElementById('create-image').value
                };

                await ApiService.createProduct(productData);
                alert('Produto criado com sucesso!');
                e.target.reset();
                loadProducts();
            } catch (error) {
                alert('Erro ao criar produto: ' + error.message);
            }
        });

        // Atualizar produto
        document.getElementById('update-product-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const productData = {
                    id: parseInt(document.getElementById('update-id').value),
                    name: document.getElementById('update-name').value,
                    description: document.getElementById('update-description').value,
                    qnt_products: parseInt(document.getElementById('update-quantity').value),
                    price: parseFloat(document.getElementById('update-price').value),
                    image: document.getElementById('update-image').value
                };

                await ApiService.updateProduct(productData);
                alert('Produto atualizado com sucesso!');
                e.target.reset();
                loadProducts();
            } catch (error) {
                alert('Erro ao atualizar produto: ' + error.message);
            }
        });

        // Funções globais para edição e deleção
        window.editProduct = async (id) => {
            try {
                const product = await ApiService.getProductById(id);
                document.getElementById('update-id').value = product.id;
                document.getElementById('update-name').value = product.name;
                document.getElementById('update-description').value = product.description;
                document.getElementById('update-quantity').value = product.qnt_products;
                document.getElementById('update-price').value = product.price;
                document.getElementById('update-image').value = product.image;
                showPage('update-page');
            } catch (error) {
                alert('Erro ao carregar produto: ' + error.message);
            }
        };

        window.deleteProduct = async (id) => {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                try {
                    await ApiService.deleteProductById(id);
                    alert('Produto excluído com sucesso!');
                    loadProducts();
                } catch (error) {
                    alert('Erro ao excluir produto: ' + error.message);
                }
            }
        };

        // Gerenciamento do tema
        function initTheme() {
            const themeSwitch = document.getElementById('theme-switch');
            const themeText = document.getElementById('theme-text');
            const savedTheme = localStorage.getItem('theme');

            // Aplicar tema salvo
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                themeSwitch.checked = true;
                themeText.textContent = 'Tema escuro';
            }

            // Listener para mudança de tema
            themeSwitch.addEventListener('change', function() {
                if (this.checked) {
                    document.body.setAttribute('data-theme', 'dark');
                    localStorage.setItem('theme', 'dark');
                    themeText.textContent = 'Tema escuro';
                } else {
                    document.body.removeAttribute('data-theme');
                    localStorage.setItem('theme', 'light');
                    themeText.textContent = 'Tema claro';
                }
            });
        }

        // Função para formatar valores monetários em BRL
        function formatCurrency(value) {
            return value.toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        // Função para atualizar o resumo
        async function updateSummary() {
            try {
                const products = await ApiService.getAllProducts();
                if (!products || products.length === 0) {
                    document.getElementById('total-quantity').textContent = '0 unidades';
                    document.getElementById('total-value').textContent = 'R$ 0,00';
                    document.getElementById('summary-list').innerHTML = `
                        <tr>
                            <td colspan="4" class="empty-state">
                                <div class="empty-state-content">
                                    <span class="material-icons empty-state-icon">inventory</span>
                                    <p>Nenhum produto cadastrado</p>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                // Calcula totais
                let totalQuantity = 0;
                let totalValue = 0;

                // Preenche a tabela de detalhamento
                const summaryHTML = products.map(product => {
                    const productTotal = product.qnt_products * product.price;
                    totalQuantity += product.qnt_products;
                    totalValue += productTotal;
                    return `
                        <tr>
                            <td>${product.name}</td>
                            <td>${product.qnt_products} un</td>
                            <td>${formatCurrency(product.price)}</td>
                            <td>${formatCurrency(productTotal)}</td>
                        </tr>
                    `;
                }).join('');

                // Atualiza os totais
                document.getElementById('total-quantity').textContent = `${totalQuantity} unidades`;
                document.getElementById('total-value').textContent = formatCurrency(totalValue);
                document.getElementById('summary-list').innerHTML = summaryHTML;
            } catch (error) {
                console.error('Erro ao carregar resumo:', error);
                document.getElementById('summary-list').innerHTML = `
                    <tr>
                        <td colspan="4" class="empty-state">
                            <div class="empty-state-content error">
                                <span class="material-icons empty-state-icon">error_outline</span>
                                <p>Erro ao carregar resumo</p>
                                <button class="button" onclick="updateSummary()">
                                    <span class="material-icons">refresh</span>
                                    Tentar Novamente
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }
        }

        // Atualizar resumo quando produtos são modificados
        const originalLoadProducts = loadProducts;
        loadProducts = async function() {
            await originalLoadProducts();
            await updateSummary();
        };

        // Carregar produtos inicialmente
        loadProducts();
        initTheme();
    </script>
</body>
</html>
